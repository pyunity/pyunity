image:
  - Ubuntu
  - Visual Studio 2017
  - Visual Studio 2019
  - macos

environment:
  matrix:
    - version: "3.9"
      venv: "../../venv3.9"
      windows_location: "C:\\Python39-x64\\python"
      windows_location2: "C:\\Python38\\python"
    - version: "3.8"
      venv: "../../venv3.8"
      windows_location: "C:\\Python38-x64\\python"
      windows_location2: "C:\\Python38\\python"
    - version: "3.7"
      venv: "../../venv3.7"
      windows_location: "C:\\Python37-x64\\python"
      windows_location2: "C:\\Python37\\python"
    - version: "3.6"
      venv: "../../venv3.6"
      windows_location: "C:\\Python36-x64\\python"
      windows_location2: "C:\\Python36\\python"

test_script:
  - python -m unittest tests.py
  - python prepare.py -x
  - python setup.py bdist_wheel
  - sphinx-apidoc -e -F -M -o docs/source pyunity pyunity/config.py pyunity/examples/*
  - sphinx-build -T -E -b html docs/source docs/en

for:
  - matrix:
      only:
        - image: Ubuntu
    install:
      - source $venv/bin/activate
      - python -m pip install cython wheel sphinx pyglm pillow coverage
      - coverage run -m unittest tests.py
      - bash <(curl -s https://codecov.io/bash)
      - rm -rf docs/source/pyunity*
  - matrix:
      only:
        - image: Visual Studio 2017
    install:
      - "%windows_location2% -m virtualenv venv"
      - venv\Scripts\activate
      - python -m pip install cython wheel sphinx pyglm pillow
      - del docs\source\pyunity*
  - matrix:
      only:
        - image: Visual Studio 2019
    install:
      - "%windows_location% -m virtualenv venv"
      - venv\Scripts\activate
      - python -m pip install cython wheel sphinx pyglm pillow
      - del docs\source\pyunity*
  - matrix:
      only:
        - image: macos
    install:
      - source $venv/bin/activate
      - python -m pip install cython wheel sphinx pyglm pillow
      - rm -rf docs/source/pyunity*

build: off
skip_branch_with_pr: true

artifacts:
  - path: dist/pyunity-0.6.0*
    name: Builds